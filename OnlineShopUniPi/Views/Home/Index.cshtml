@{
    ViewData["Title"] = "Home Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="hero-section">
    <h1>Welcome to ClothSwap!</h1>
    <p>Buy or sell clothes with style, safety, and convenience.</p>
    <a <a asp-controller="Products" asp-action="GetProducts" class="cta-button">Get Started</a>
</section>

<!-- Top Favorited Products Algorythm Section -->
<section class="section">
    <h2>✨ Top Favorites</h2>
    @if (ViewBag.TopFavorited is List<OnlineShopUniPi.Models.Product> topFavorites && topFavorites.Any())
    {
        <section class="section">
            <div class="products">
                @foreach (var item in topFavorites.Where(p => p.Quantity >= 1))
                {
                    // Get main image or placeholder
                    var mainImage = item.ProductImages?.FirstOrDefault(img => img.IsMainImage == true)?.ImageUrl;

                    // If no image found, use placeholder
                    if (string.IsNullOrEmpty(mainImage))
                    {
                        mainImage = "images/resources/no_image.png";
                    }

                    <div class="product-card">
                        <a href="@Url.Action("Details", "Products", new { id = item.ProductId })">
                            <img src="@Url.Content("~/" + mainImage.TrimStart('/'))"
                                 class="card-img-top p-3 object-fit-contain bg-light"
                                 style="height:200px;"
                                 alt="@item.Title" />
                            <h3>@item.Title</h3>
                            <p>€@item.Price</p>
                        </a>
                    </div>
                }
            </div>
        </section>
    }
</section>

<section class="about-section">
    <h2>About Us</h2>
    <p>
        ClothSwap is a platform that brings fashion enthusiasts together in a vibrant and safe community. Through our app, registered users can buy and sell both new and pre-loved clothing, giving cherished pieces a second life. We provide a reliable environment, easy navigation, and dedicated support, ensuring that every transaction is simple, secure, and enjoyable. ClothSwap is more than just a marketplace — it’s a community that connects people who share a passion for fashion and sustainability.
    </p>
</section>

<!-- Recent Products Section -->
<section class="section">
    <h2>Latest Additions</h2>
    @if (ViewBag.LatestProducts is List<OnlineShopUniPi.Models.Product> latestProducts && latestProducts.Any())
    {
        <div class="products">
            @foreach (var item in latestProducts.Where(p => p.Quantity >= 1)) // only show in-stock items
            {
                // Get main image or placeholder
                var mainImage = item.ProductImages?.FirstOrDefault(img => img.IsMainImage == true)?.ImageUrl;

                // Use placeholder if no image exists
                if (string.IsNullOrEmpty(mainImage))
                {
                    mainImage = "images/resources/no_image.png"; 
                }

                <div class="product-card">
                    <a href="@Url.Action("Details", "Products", new { id = item.ProductId })">
                        <img src="@Url.Content("~/" + mainImage.TrimStart('/'))"
                             class="card-img-top p-3 object-fit-contain bg-light"
                             style="height:200px;"
                             alt="@item.Title" />
                        <h3>@item.Title</h3>
                        <p>€@item.Price</p>
                    </a>
                </div>
            }
        </div>
    }
    else
    {
        <p>No recent products available.</p>
    }
</section>
